<div class="ui modal" id="id_experiment_modal">
    <div class='content'>
    <form method="post" class="ui form" id="create_experiment" enctype="multipart/form-data">
        {% csrf_token %}
            {{ form.as_p }}
        </form>
    </div>
    <div class="actions">
        <div class="ui red deny button">
            Отмена
        </div>
        <div class="ui positive right labeled icon button" id="id_btn_create_experiment">
            Сохранить
            <i class="checkmark icon"></i>
        </div>
    </div>
</div>

<script>

$("#create_experiment").submit(function(event){
    event.preventDefault();

    var formData  = new FormData(this);
    var createPostUrl = "{% url 'trial:create_experiment' trial.pk %}";
    $.ajax({
        method   : "POST",
        url      : createPostUrl,
        data     : formData,
        processData:false,
        contentType:false,
        success  : function(data){
            location.reload(true); 
        },
        error    : function(data){
            console.log("ERROR:CH0x2 while fetching after creation form submit");
            console.log("data :",data.status, data.statusText);
        }
    });
 });

 $("#id_btn_create_experiment")
    .on('click', function () {
        let form = $('#create_experiment').serialize();
        console.log(form);
        $.ajax({
            method: 'post',
            url: '{% url 'trial:create_experiment' trial.pk %}',
            data: form,
            success: function () {
                location.href = '{% url 'trial:detail' trial.pk %}';
            }
        })
    });

</script>
